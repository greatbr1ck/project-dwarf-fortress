<h1>Описание проекта</h1>
Проект – игра, похожая на Dwarf Fortress. Игровой мир – квадратное поле (заданного фиксированного размера) в двух режимах – «над землей» и «под землей». 

<h2>Дварфы</h2>
Игрок управляет отрядом дварфов (численность отряда выбирается пользователем в самом начале игры), каждый из дварфов имеет определенную рабочую обязанность: «обработку камня», «обработка металлов», «здравоохранение», «производство». Дварф не может иметь несколько рабочих обязанностей, как и менять установленную в начале игры (выбирая отряд дварфов, игрок задает каждому уникальное имя и обязанность. Внутри отряда могут быть несколько дварфов могут иметь одну и ту же обязанность, некоторые обязанности могут отсутствовать вовсе).  

Дварф, обладающий обязанностью «обработка камня», может отделывать добытый камень (так чтобы он стал пригодным для строительства) и делать каменные орудия труда.  

Дварф, обладающий обязанностью «обработка металла», способен переплавлять любую добытую металлическую руду, изготавливать любые металлические инструменты, оружие и броню.   

Дварф, обладающий обязанностью «здравоохранение», может лечить других дварфов и себя (во время боя с монстрами дварфы могут терять единицы здоровья, в этом случае дварф-целитель будет крайне полезен).   

Дварф, обладающий обязанностью «производство», способен изготавливать деревянные инструменты. Без него, в частности, остальные дварфы не смогут получить инструменты из камня и металла.  

Помимо этого, дварфы способны воевать, переносить вещи, добывать руду и дерево. Эти качества присущи всем дварфам независимо от обязанности. 
В начале игры происходит генерация мира (обоих его частей – подземной и надземной). Дварфы появляются без брони, инструментов и какого-либо имущества. Каждый дварф имеет некоторое фиксированное ограниченное место в инвентаре, одинаковое для всех. Для того, чтобы дварф мог выполнять свою обязанность, необходимо наличие в его инвентаре определенных вещей. Так, дварф-целитель должен носить с собой ведро воды и пучок травы, дварф-металлург должен иметь при себе металлическую руду, молот и уголь, дварф-каменщик должен иметь при себе деревянную (или любую другую) кирку (инструменты могут быть только деревянные, каменные, или железные). Лишь дварф-производитель не должен иметь при себе каких-то определенных инструментов. Итак, дварфы появляются на верхнем уровне мира. Чтобы попасть в подземелье, достаточно вскопать вниз в любой точке (выходит, что игровое поле – пространство {0, 1}x{0, 1, …, M}x{0, 1, …, M}, где M – ограничение на размерность поля подземного и наземного миров).  

Дварфы управляются независимо друг от друга. У каждого дварфа есть набор действий, которые он может сделать (свойства обязанности или прочие – указаны выше). Для некоторых действий (например, добычи дерева, камня или руды), можно указать конкретному дварфу прямоугольную область (заданную координатами двух противоположных углов прямоугольника) в мире, в котором он сейчас находится (подземелье или наземный), и дварф будет выполнять заданное действие, перемещаясь по области. Если действие предполагает складывание вещей в инвентарь, дварф может не закончить выполнение всей области в связи с заполнением инвентаря (пример: добыть руду на заданной области). 
Чтобы опустошать инвентарь, можно указать область на карте, куда дварф отправится и сложит указанный вещи, помеченные как «мусор». 
Для каждого дварфа пользователю доступен экран этого дварфа: дварф видит на K тайлов (тайл – единица игрового поля) вокруг себя (то есть, экран таков, что в центре квадрата размера K*K стоит дварф). Если в инвентаре дварфа есть факел, он видит дальше.
Пользователь видит координаты каждого живого дварфа в игре, может посмотреть его инвентарь и его оставшееся здоровье. 
Если дварф завершил задание, данное ему игроком, он ничего не делает.   

Дварфы могут обмениваться вещами посредством сундука, который может сделать дварф-производитель. 
Каждое оружие дварфа имеет фиксированный урон и не ломается (как и любой другой инструмент). Умирая, дварф теряет все снаряжение и инструменты. Воскресить его невозможно.  


<h2>Игровой мир</h2>
Каждый дварф не может сломать тайл, не добыв его (то есть не положив в свой инвентарь). Над землей дварф не может идти в области, где есть клетка дерева или реки, может ходить только по земле или траве (типы поверхности над землей – земля, вода, листья, дерево). Добыв дерево, тайл становится землей, в него можно наступить.  

Если дварфы спускаются под землю, они не могут ходить нигде кроме пещер. Пещерой становится любая область под землей, где нет блоков (типы поземных блоков: руда [железо, золото], камень, уголь.   

Под землей есть пещеры, которые связаны между собой тоннелями.   

Генерация мира происходит псевдослучайно. Опишу на примере подземелья.   

Все поле равномерно заполняется камнем. Выбираются рандомные точки на поле, рандомный радиус, выбранная область меняет тайлы на железо. Аналогично с золотом и углем.   

Далее некоторое рандомное число раз выбираются N клеток поля (N тоже случайное число). Для каждой выбирается случайный радиус. Тайлы, соответствующие этой области становятся пустыми (сделали пещеру). К примеру, заливкой области может заниматься BFS. Для каждой пещеры ищется расстояние до ближайшей другой. Пещеры данного этапа – связный граф. Тайлы на этом кратчайшем пути становятся тайлами типа «пещера». 
После N повторений получилось N компонент связности (если считать пещеры вершинами). С проведением путей может справиться алгоритм A*.   


<h2>Гоблины</h2>
Гоблины – единственный (по крайней мере пока что) тип монстров в игре. Гоблины рандомно распределяются по пещерам во время генерации мира и живут только под землей. Если гоблин видит дварфа в некотором радиусе, он нападает. Возникает бой, который кончится смертью дварфа или гоблина. Гоблин имеет полосу здоровья и фиксированный урон. По умолчанию, гоблин стоит внутри своей пещеры и через некоторое фиксированные число игровых тактов начинает идти вдоль самого длинного пути из своей пещеры, а затем возвращается назад, если в это время он не встретил дварфа. Возможно, в пещерах гоблинов стоит сделать сундуки с уникальными вещами.  


<h1>Функционал</h1>
Игроку доступны окна видимости дварфов, их инвентари и полоски здоровья.   

Игровое поле – предположительно из ASKII символов, как оригинальная игра.  

Есть отдельное пространство, где содержится информация про каждого дварфа: его имя, координаты, рабочая обязанность. Пользователь может вызвать его инвентарь и окно видимости (где отражено, что видит дварф вокруг себя в текущий момент времени). Для каждого дварфа есть кнопки управления: атаковать, пометить предмет инвентаря как мусор, определить область как свалку и отнести туда мусор, добыть дерево в заданной области, добыть руду в заданной области, добыть камень в заданной области, добыть все в заданной области, забрать вещи из сундука. 
Кнопки только для определенных рабочих обязанностей:  

вылечить дварфа с заданным именем (только для целителя); сделать деревянную кирку, сделать факел, сделать сундук (только для производителя); обработать камень (только для каменщика) и прочее.  

Управление дварфами происходит как одно действие за ход (в ход игрока игрок делать по одному ходу за каждого дварфа). Пока что предполагается интерактив – ход игрока сменяется ходом программы (формально играющей за гоблинов).  

Вероятно, кнопки для рабочих обязанностей, связанные с крафтом вещей стоит делать в выпадающем списке, поскольку их слишком много.
Некоторые кнопки могут быть недоступны, в связи с определением данного конкретного функционала (например, свойство каменщика может быть недоступно, если у него нет камня в инвентаре, аналогично целитель не может восстанавливать здоровье дварфа, если не обладает травой (собранной сверху) и водой).    

Во время боя дварф может атаковать только врагов, находящихся в соседнем с ним тайле, причем урон наносится всем врагам, стоящим на всех соседних с ним тайлах. Возможно, стоит добавить лучников, которые могут нарушать правило "бить только соседей".
Аналогично гоблин атакует всех дварфов на соседних тайлах с его тайлом. И аналогично целитель лечит всех его дварфов-соседей. 
Реализовать это можно так: пусть у каждого объекта дварфа или монстра есть уникальный номер (id), который выдается ему при инициализации мира. Есть массив (пул сущностей), такой что по индексу id лежит объект класса с данным id. Во время взаимодействия персонажей друг с другом происходит обращение к этому пулу сущностей.


<h1>Архитектура</h1>
<h2>Классы</h2>

```
#тайлы
class Tile:
  pass

#игровые глобальные переменные
class Environment:
  #наземное поле - список списоков Tile
  field

  #подземное поле - список списоков Tile
  dungeon

  #список сущностей персонажей (обращением к списку по id получим объект)
  entities_list

  #список сущностей персонажей
  dwarfes_set (обращением к entities_set по имени дварфа получим id этого дварфа)

  #таймер
  timer


#вещи, поместимые в инвентарь
class Thing:
  #урон (целое число)
  damage

  #помечена ли мусором
  is_garbage


#оружие
class Weapon(Thing):
  pass


#броня
class Armor(Thing):
  pass


#инструменты
class Instrument(Thing):
  pass


#сундук
class Chest:
  #содержимое - массив объектов
  environment


#инвентарь
class Inventory:
  #содержимое - массив объектов
  environment

  #размер
  size

  #флаг, заполнен ли
  is_filled

  #пометить одну вещь с именем name как мусор
  def mark_garbage(name):
    pass


#класс дварфа
class Dwarf:
  #радиус поля, которое видит дварф (список списков) - экрана, который видит пользователь (формально - маска на поле field[i], i=0,1)
  radius_to_see
  
  #радиус поля, которое видит дварф с факелом 
  radius_to_see_with_torch
  
  #количество оставшихся единиц здоровья (целое число)
  health
  
  #рабочая обязанность (строковая константа)
  work_type

  #координаты (тройка целых чисел)
  coords

  #инвентарь (объект класса Inventory)
  inventory

  #жив/мертв (булевая величина)
  is_alive

  #id (целое число)
  id

  #флаг, который говорит, что именно сейчас делает дварф (делает ли какую-то выданную ему ранее команду и еще не закончил)
  #если этот флаг выставлен (то есть дварф еще делает дело, doing_command != none), и ему поступила новая команда, он бросит выполнение старой #команды
  doing_command

  #направление движения - север, юг, запад или восток
  direction

  #атаковать
  def fight():
    #получить id врагов на соседних тайлах и записать им урон
    #урон выбирается как максимум урона по вещам в инвентаре

  #собрать вещь с тайла с координатами tyle_coords
  def take(tyle_coords):
    pass

  #собрать вещь с названием name из сундука с координатами chest_coords
  def take_from_chest(name, chest_coords):
    pass

  #выкинуть вещи, помеченные как мусор из инвентаря в область, заданную двумя углами coords1, coords2
  def through(coords1 coords2):
    pass
  
  #поставить 1 блок перед собой
  def build():
    pass

  #добыть руду в области, заданной углами coords1, coords2
  def mine(coords1, coords2):
    pass

  #добыть камень в области, заданной углами coords1, coords2
  def dig(coords1, coords2):
    pass

  #срубить деревья в области, заданной углами coords1, coords2
  def cut_down(coords1, coords2):
    pass

  #геттеры для первых 

  #переместиться в указанну координату coords
  def move(coords):
    #установить doing_command = move
    #вызовется функция для поиска кратчайшего пути между текущей координатой и заданной
    #за 1 такт дварф будет двигаться вдоль этого пути до цели

  #функции для передвижения на 1 тайл вправо/влево/вперед/назад

  #сказать дварфу перестать делать длительную команду, которую ему приказали сделать
  def terminate():
    doing_command = none


#камещик
class Mason(Dwarf):
  #обработать камень
  def make_brick():
    pass

  #далее методы для создания каменных инструментов


#целитель
class Healer(Dwarf):
  #вылечить дварфов, которые находятся на соседних тайлах с тем, где стоит целитель
  def heal():
    pass

  #вылечить дварфа с именем name
  def heal_special(name):
    #у дварфа с именем name будут запрошены координаты
    #дварф-целитель найдет кратчайший маршрут до этого дварфа и будет двигаться вдоль него
    #скорее всего, алгоритм поиска кратч пути придется запускать после каждого такта, поскольку дварфы могут двигаться


#производитель
class Craftsman(Dwarf):
  #сделать факел
  def make_torch():
    pass:

  #далее методы для изготовления других инструментов


#металлург
class Metallurgist(Dwarf):
  #получить слиток переплавленной руды типа name
  def melt_down(name):
    pass

  #далее методы для создания металлических инструментов


#гоблин
class Goblin:
  #часть поля, которое видит гоблин (список списков)
  field_to_see
  
  #количество оставшихся единиц здоровья (целое число)
  health

  #координаты (тройка целых чисел)
  coords

  #жив/мертв (булевая величина)
  is_alive

  #id (целое число)
  id

  #время, которое ждет гоблин в пещере
  waiting_time

  #локальный таймер, исчерпывающий waiting_time
  waiting_timer 

  #атаковать
  def fight():
    #получить id врагов на соседних тайлах и записать им урон
    #урон выбирается как максимум урона по вещам в инвентаре

  #идти вдоль самого длинного пути из пещеры
  def discover_area():
    #построить самый длинный путь до достижимой пещеры и идти вдоль него

  #проверить территорию на дварфов
  def check_dwarfes():
    если есть дварф в части поля, которую видит гоблин (field_to_see), идти туда


<h2>Функции</h2>
 
 #инициализация игры
 def init_game():
  #поля инициализируются случайно с помощью вспомогательных функций, описанных выше
  
  #игроку предлагается выбрать количество дварфов в его отряде
  #внутри main создается список дварфов
  #игрока спрашивают рабочие обязанности дварфов, на основе этого дварфу выдается рабочая обязанность

  #в подземелье выставляются гоблины


#игра
def play_game():
  #игра происходит в интерактивном формате с игроком (программа и игрок обмениваются ходами, не ходят параллельно)
  #в ответ на ход игрока программа запускает методы для гоблинов - увеличить таймер или запустить проверки территорий


#разные функции для поиска кратчайшего пути от точки до точки (вероятно, придется писать A*)
#bfs для заливки территорий во время инициализации

```